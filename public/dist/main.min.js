angular.module("photo.photos",["photo.services"]).controller("PhotoController",["$scope","PhotoReq",function(a,b){a.creds={},a.images=[];var c;b.getCred().then(function(b){a.creds=b.data,AWS.config.update({accessKeyId:a.creds.access_key,secretAccessKey:a.creds.secret_key}),AWS.config.region=a.creds.region,c=new AWS.S3({params:{Bucket:a.creds.bucket}}),a.refresh()}),a.refresh=function(){c.listObjects(function(b,c){if(b)console.log(b);else{a.images=[];for(var d=1;d<c.Contents.length;d++)a.images.push({url:"http://dropbucket-mikemsrk.s3.amazonaws.com/"+c.Contents[d].Key});a.$apply()}})},a.upload=function(){if(a.file){var b={Key:"images/"+a.file.name,ContentType:a.file.type,Body:a.file,ServerSideEncryption:"AES256",ACL:"public-read"};c.putObject(b,function(b,c){return b?(alert(b.message),!1):(console.log(c),alert("Upload Done"),a.refresh(),void 0)}).on("httpUploadProgress",function(a){console.log(Math.round(a.loaded/a.total*100)+"% done")})}else alert("No File Selected")}}]);var directives=angular.module("photo.directives",[]);directives.directive("file",function(){return{restrict:"AE",scope:{file:"@"},link:function(a,b,c){b.bind("change",function(b){var c=b.target.files,d=c[0];a.file=d,a.$parent.file=d,a.$apply()})}}}),angular.module("photo.services",[]).factory("PhotoReq",["$http",function(a){var b=function(){return a({method:"GET",url:"/api/creds"})};return{getCred:b}}]),angular.module("photo",["ui.router","photo.photos","photo.directives","photo.services"]).run(["$state",function(a){a.go("home")}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"app/templates/photos.html",controller:"PhotoController"})}]);